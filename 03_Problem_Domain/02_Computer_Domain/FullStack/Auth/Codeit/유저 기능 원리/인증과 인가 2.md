## 세션 기반 인증
새션과 토큰으로 나뉘고
각각 세션 기반 인증, 토큰 기반 인증이라고도 한다.

세션이란 서버가 저장하는 사이트 방문자들에 대한 기록이다.
서버는 클라이언트가 오면 데이터를 저장한다.
![[Pasted image 20251004181926.png]]
클라이언트가 서버로 쿠기: 세션아이디를 보내주기에 매칭된 유저를 찾아 요청을 처리해줄수있다.
![[Pasted image 20251004182032.png]]
특정 세션시간이 지나면 로그인된유저나 아닌유저를 만료처리합니다.
그러면 기존 세션아이디로 못찾기떄문에 다시 로그인하여 세션아이디를 발급받아야된다.

**유저아이디가 사라지는것이 아니라, 세션아이디가 사라진다.**
대부분 탈퇴한 유저id는 다른 새로운 유저가 가입을 하더라도 재배정 하지 않고, 마지막으로 부여된 번호에서 1씩 증가하도록 배정을 하고 있습니다.

세션id도 마찬가지로 세션이 만료되어 삭제하더라도, 이미 시용한 세션id는 재사용을 하지 않습니다.
그 이유는 세션id는 로그인 정보이기 때문에 재사용을 하게 되면 다른 유저로 로그인 되어버리는 보안 취약점이 발생할 수 있기 때문입니다.

## 토큰 기반  인증
인증 토큰(유저에 대한 정보를 암호화한 문자열)을 이용하여 인증을 함 (접근토큰 사용)
토큰 자체를 해석해서 사용하면된다.

```
user_id=1234,
expiration_date=2025/05/20

서버에서는 비밀키를 이용하여 암호화

eyjsAv..
```
암호화 함수에 user_id,expiration_date, + 시크릿 키를 이용해서 파라미터로 전달하면 암호화를 시켜주고 
암호화 푸는 함수에 시크릿 키 + 암호화된 문자열을 넣으면 월래 user_id,expration으로 해독됨

요즘은 JWT(JSON Web Token)을 많이사용한다.
서버에서 req바디에 전달하는게 일반적이다.
클라이언트에서는 리퀘스트로 받은 토큰을 authorization header에 js코드로 붙여서 보내는것
```http
GET http...
Authorization: Bearer eyjsavl...
```
다시 서버에서는 이 키를 받아 해독화한다. 유효성검사및 간단한 테스트를 거치고 특정 유저를 구분짓는다. 만료되지 않으면 계속 로그인 상태를 유지할수있다. 로그아웃을 하고싶다면 클라이언트에서 직접 토큰을 삭제시키면된다.

## 인코딩과 Base64URL
인코딩 : HTTP header , name, value는 효율성과 안정성을 위해 미리 정해진 256개의 문자들만 사용해야 한다. ASCII라는 표준에 포함된 문자들이다. 이 표준을 따르면 실제로 0과 1로 저장되는 데이터가 여러 컴퓨터에서 다르게 해석되는것을 방지한다.

쉽고 안정적으로 사용하기 위해 통일된 형식으로 바꾸는것을 '인코딩'이라고 한다. 읽는 사람이 알기  힘들게 하는 '암호화'와는 조금 다른 개념이다.
여러 인코딩 방식이있다. 웹이서는 base64url을 많이쓴다.

Base64 인코딩 : 0,1로 표현 6자리씩 끊어 ASCII에 포함된 64문자 중 하나로 바꿔주는 인코딩 형식
`000000 = A, 101000 = o`이런식 000000 ~ 111111 까지 각 숫자에 해당하는 문자로 바꾸는것이다.

(64개의 문자열은 모든 영문 대소문자, 모든 숫자, 그리고 `+` 와 `/`로 이뤄져 있죠. 자릿수가 부족할 때는 `=` 문자로 채워 넣습니다.) -> 그 어떤 데이터도 인코딩가능하다.
```
À È Ì Ò Ù Ỳ Ǹ Ẁ <=> w4Agw4ggw4wgw5Igw5kg4buyIMe4IOG6gA==
한글도 인코딩할 수 있어요 <=> 7ZWc6riA64-EIOyduOy9lOuUqe2VoCDsiJgg7J6I7Ja07JqU
```
> 반대로 오른쪽이 base64방식 인 것을 알면 누구나 손쉽고 빠르게 디코딩할수있다.

Base64URL 인코딩 : 거의 똑같은 방식 + / -> - _ 를 사용
죽, 웹에서 두 문자에 의미가 더 부여돼 해석될 가능성을 줄여, 조금 더 안전하게 사용할수있다는점

## 기본 인증 (Basic Authentication)
Authorizaiton 뒤 Basic, 그리고 이메일과 비밀번호를 : 로 이어붙이면된다.
```http
Authorization: Basic email:password
```
Bearer/Token/Basic은 서버에게 뒤에 붙이는 인증정보의 종류를 서버에게 알리기위함이다.
username:password 이 부분을  서버로 보내기전 base64url로 인코딩한다.
-> Authorization: Basic Y26kuwj2j28218....
req보내면 서버가 Basic을 통해 뒤에  정보가 기본 인증이란것을 파악후 디코딩해 유저를 인증한다.

단점
- 요즘 안사용함 -> 보안 문제 때문에
- 공격자가 중간에 가로챌 위험이 커진다.
- 로그인 상태를 유지하기위해 클라이언트가 이메일  비번을 어딘가에 저장함
- 민감한 정보를 브라우저에 저장해놓는 것은 위험에 노출될 여지 -> 불안전
- 다양한 프레임워크에서 이 기본 인증을 지원하기는 하지만 그냥 이런게 있구나 하고 넘기기?
