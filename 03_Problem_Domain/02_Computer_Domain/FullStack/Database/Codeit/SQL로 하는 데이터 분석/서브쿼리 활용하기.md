## 서브쿼리란?
>  따로 쿼리창을 열러 알고난다음 넣지않고 편하게 선언을 할수있게 해준다.
```sql
select  i.id, i.name, AVG(star) AS avg_star
from item AS  i LEFT OUTER JOIN review AS r
ON r.item_id = i.id
group by i.id, i.name
having avg_star < (review테이블에서 전체 평균 별점값을모름)
order by avg_star DESC;
```

```sql
## 굳이 다른 쿼리에서 계산한다음 넣어도되지만 그냥 선언식에다 넣을수있다.
select  i.id, i.name, AVG(star) AS avg_star
from item AS  i LEFT OUTER JOIN review AS r
ON r.item_id = i.id
group by i.id, i.name
having avg_star < (select AVG(star) from review)
order by avg_star DESC; 
```
> 부품처럼 하나의 또다른 쿼리가 또 SQL문안에 들어있다.
> 이러한 서브쿼리를 사용할려면 괄호를 사용해야 오류가 안납니다.

## SELECT절에 있는 서브쿼리
> 원래 컬럼에없던 컬럼을 새로 추가해서 보겠다는말이다.
```sql
select
    id,name,price,(select AVG(price) from item) AS avg_price
from
	item;
```

##  WHERE 절에 있는 서브쿼리 1
```sql
select
    id,
    name,
    price,
    (select AVG(price) from item) AS avg_price
from
    item
WHERE price > (select AVG(price) from item)
```
> 이런식으로 가격의 전체 평균 보다 높은 가격만 볼수있게할수있다.

##  WHERE 절에 있는 서브쿼리 2
아이템에  리뷰수가 3개이상이것들을 보고싶다면?
join
```sql
select
* 
from
item AS i LEFT OUTER JOIN review AS r
on i.id = r.id
where r.star >= 3
```

```sql
select
* 
from
item
where id IN 
(
    select item_id from review group by item_id HAVING COUNT(star) >= 3
)
```

## ANY(SOME).ALL
**ANY(SOME)**
~중에 하나라는 뜻을 가지는 단어고, 안에 들어가는 값중 하나라도 조건을 만족하는지 검사해주는 연산자이다.
```sql
select view_count from theater where category = "ACTION"

...

select * from theater
	where view_count > ANY(select view_count from theater where category = ACTION) AND category != "ACTION"
```
> ANY가 WHERE절에 사용될때는 서브 쿼리의 결과에 있는 각 로우의 값 중 하나라도 만족하면 트루를  리턴한다.

