## Redis를 문서 데이터베이스로 사용하는 방법 이해
1. create a seconary index 보조 인덱스 만들기
2. add JSON documents JSON문서 추가
3. search and query your data 데이터 검색 및 쿼리

다음 구조의 예지를 사용 간단한 자전거 인벤토리를 참조
```json
{
  "brand": "brand name",
  "condition": "new | used | refurbished",
  "description": "description",
  "model": "model",
  "price": 0
}
```

---
## 연결 하고 나서 인덱스 만들기
키스페이스를 스캔하는 방법을 배웠다.
FT.CREATE일부 텍스트 필드, 숫자 필드 및 태그 필드(조건)가 있는 인덱스를 만드는 명령이다.
텍스트 필드의 가중치는 1.0이며, 이는 전체 텍스트 검색의 컨텍스트에서 동일한 관련성을 갖는다는것을 의미한다. 필드 이름은 JSONPath 개념을 따른다.
```redis-cli$
> FT.CREATE idx:bicycle ON JSON PREFI 1 bicycle: SCORE 1.0 SCHEMA $.brand AS brand TEXT WEIGHT 1.0 $.model AS model TEXT WEIGTH 1.0 $.description as description TEXT WEIGHT 1.0 $.price AS price NUMERIC $.condition AS condition TAG SEPARATOR ,
```
> 보기 쉽게 한다면
```node.js
const schema = {
  '$.brand': {
    type: SCHEMA_FIELD_TYPE.TEXT,
    SORTABLE: true,
    AS: 'brand'
  },
  '$.model': {
    type: SCHEMA_FIELD_TYPE.TEXT,
    AS: 'model'
  },
  '$.description': {
    type: SCHEMA_FIELD_TYPE.TEXT,
    AS: 'description'
  },
  '$.price': {
    type: SCHEMA_FIELD_TYPE.NUMERIC,
    AS: 'price'
  },
  '$.condition': {
    type: SCHEMA_FIELD_TYPE.TAG,
    AS: 'condition'
  }
};

try {
  await client.ft.create('idx:bicycle', schema, {
    ON: 'JSON',
    PREFIX: 'bicycle:'
  });
} catch (e) {
  if (e.message === 'Index already exists') {
    console.log('Index exists already, skipped creation.');
  } else {
    // Something went wrong, perhaps RediSearch isn't installed...
    console.error(e);
    process.exit(1);
  }
}
```

## JSON 문서 추가
SET명령을 사용하여 새 JSON 문서를 만듬
```redis-cli
JSON.SET "bicycle:0" "." "{\"brand\": \"Velorim\", \"model\": \"Jigger\", \"price\": 270, \"description\": \"Small and powerful, the Jigger is the best ride for the smallest of tikes! This is the tiniest kids\\u2019 pedal bike on the market available without a coaster brake, the Jigger is the vehicle of choice for the rare tenacious little rider raring to go.\", \"condition\": \"new\"}"
```
> 인덱스를 만들고 이제 JSON문서를 추가했다면 search by values of keys를 사용해서 데이터를 검색해볼수있다.
![[Pasted image 20251003015833.png]]
## Redis 쿼리 엔진을 사용하여 검색 및 쿼리

**와일드 카드 쿼리(Wildcard query)**
FT를 사용하여 색인화된 모든 문서를 검색할 수 있다. SEARCH 명령을 사용한다. 결과 페이지 매김을 허용하는? 아래 LIMIT절에 유의를 한다.
```redis-cli
> FT.SEARCH "idx:bicycle" "*" LIMIT 0 10
1) (integer) 10
 2) "bicycle:1"
 3) 1) "$"
    2) "{\"brand\":\"Bicyk\",\"model\":\"Hillcraft\",\"price\":1200,\"description\":\"Kids want to ride with as little weight as possible. Especially on an incline! They may be at the age when a 27.5\\\" wheel bike is just too clumsy coming off a 24\\\" bike. The Hillcraft 26 is just the solution they need!\",\"condition\":\"used\"}"
 4) "bicycle:2"
 5) 1) "$"
    2) "{\"brand\":\"Nord\",\"model\":\"Chook air 5\",\"price\":815,\"description\":\"The Chook Air 5  gives kids aged six years and older a durable and uberlight mountain bike for their first experience on tracks and easy cruising through forests and fields. The lower  top tube makes it easy to mount and dismount in any situation, giving your kids greater safety on the trails.\",\"condition\":\"used\"}"
 6) "bicycle:4"
 7) 1) "$"
```
```node.js
let result = await client.ft.search('idx:bicycle','*', {
	LIMIT: {
		from: 0,
		size: 10	
	}
});
console.log(JSON.stringify(result, null, 2));
```

## 단일 용어 전체 텍스트 쿼리
특정 모델의 모든 자전거를 찾기 위한 간단한 단일 용어 쿼리를 보여준다.
```redis-cli
> FT.SEARCH "idx:bicycle" "@model:Jigger" LIMIT 0 10
1) (integer) 1
2) "bicycle:0"
3) 1) "$"
   4) "{\"brand\":\"Velorim\",\"model\":\"Jigger\",\"price\":270,\"description\":\"Small and powerful, the Jigger is the best ride for the smallest of tikes! This is the tiniest kids\xe2\x80\x99 pedal bike on the market available without a coaster brake, the Jigger is the vehicle of choice for the rare tenacious little rider raring to go.\",\"condition\":\"new\"}"
```
```node.js
result = await client.ft.search(
	'idx:bicycle',
	'@model:Jigger',
	{
		LIMIT: {
			from: 0,
			size: 10	
	}
});
// ft.search('idx:bicycle','@model:Jigger',{LIMIT: {from: 0, size: 10}})
console.log(JSON.stringify(result, null, 2));
```

## 정확히 일치 쿼리
브랜드 이름이 Noka Bikes인 모든 자전거를 찾는 정확히 일치하는 쿼리를 수행하는 명령
텍스트 필드에서 정확히 일치하는 쿼리를 구성시 검색어 주위에 큰따옴표를 사용해야한다.
```redis-cli
> FT.SEARCH "idx:bicycle" "@brand:\"Noka Bikes\"" LIMIT 0 10
1) (integer) 1
2) "bicycle:4"
3) 1) "$"
   4) "{\"brand\":\"Noka Bikes\",\"model\":\"Kahuna\",\"price\":3200,\"description\":\"Whether you want to try your hand at XC racing or are looking for a lively trail bike that's just as inspiring on the climbs as it is over rougher ground, the Wilder is one heck of a bike built specifically for short women. Both the frames and components have been tweaked to include a women\xe2\x80\x99s saddle, different bars and unique colourway.\",\"condition\":\"used\"}"
```
```node.js
result = await client.ft.search(
	'idx:bicycle',
	'@brand: "Noka Bikes',
	{
		LIMIT: {
			from: 0.
			size: 10	
		}	
	}
);

console.log(JSON.stringify(result,null,2));
```