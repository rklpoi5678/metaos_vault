## 미들웨어로 req,res 다루기
```js
function one(req,res,next) {
	console.log(req.query);
	return next();
}
function two(req,res,next) {
	console.log(req.query);
	return next();
}
function three(req,res,next) {
	console.log(req.query);
	return res.json({message: 'Hello Codeit!'}); 
}

// 객체이기에 3가지다 똑같은 출력을 보여줄것이다.
app.get('/hello', one,two,three);
```
```js
// 대표적으로 로그인을 통과한 회원이 다른 사이트로 이동할때마다 인증을 안거치게 할수있다
function authentication(req,res,next) {
	req.user = 'codeit';
	next();
}
```
## 에러 처리하기
회원가입에 필요한값이 넘어오지않을수있고, 누군가가 가입한 아이디로 들어올수도있고,...
오류가 발생했을때 다른 값으로 돌려주는 에러 핸들러가 필요하다.

express에서는 내장된 에러 핸들러가있다.

```js

function error(req,res,next) {
	throw new Error('에러 발생!');
	next();
}

function ok(req,res,next) {
	res.json({ message: 'OK!'});
}

app.get('/error', error, ok);
// 어떠한 다른 경로가 오더라도
// 에러가 오면 이 핸들러로 실행하게 되어있습니다
// 그것이 싫다면 경로를 설정해주면된다.
// 각 상황에 맞는 적절한 방식을 선택
app.use((err,req,res,next) => {
	console.log(err);
	res.json({message: '에러 핸들러!'})
})
```

## 내장 미들웨어
express에 내장된 미들웨어기능을 내장 미들웨어라고한다.
```js
//express.json()
// express.json() 라우터보다 앞쪽에 위치해야한다.
app,use(express.json());
// 기본적으로 함수를 반환하는 메소드
// app.use((req,res,next) => { ... })
app.post('/products',(req,res) => {
	console.log(req,body) //이 바디내용을 사용하기위해서 express.json()을 사용해야한다.
	res.json({message:"Product 추가히기"});
});

// express.urlencoded()
// 이것또한 사용하는 다른 라우트보다 위에 있어야한다.
app.use(express.urlencoded({extended: true}));
// application/x-www-form-urlencoded
// 이제 아럐 HTTP요청에서 바디부분이 보일껏이다.
POST http://localhost:3000/products
Content-Type: apllication/x-www-form-urlencoded

name=codeit%age=20

// express.static()
// 퍼블릭 파일이 위치한 곳을 아규먼트로 넘겨주면 경로에 요청을보내서 스태틱한 파일에 접근이 가능해진다.
app.use(express.static('public'));

GET http://localhost:3000/codeit.png

###

GET http://localhost:3000/index.html
```

리퀘스트 바디 내용은 req.body에 그냥 가져오는게 아니라 => express.json() 미들웨어가 필요하다.
```js
app.post('/posts', (req,res)=> {
// const title = req.body.title;
// const content = req.body.content 로 해도되긴함
	const { title, content} = req.body;
	res.status(201).json({ title, content})
})
```