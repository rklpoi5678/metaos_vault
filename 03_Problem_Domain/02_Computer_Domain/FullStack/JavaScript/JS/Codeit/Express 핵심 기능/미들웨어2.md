## 미들웨어로 req,res 다루기
```js
function one(req,res,next) {
	console.log(req.query);
	return next();
}
function two(req,res,next) {
	console.log(req.query);
	return next();
}
function three(req,res,next) {
	console.log(req.query);
	return res.json({message: 'Hello Codeit!'}); 
}

// 객체이기에 3가지다 똑같은 출력을 보여줄것이다.
app.get('/hello', one,two,three);
```
```js
// 대표적으로 로그인을 통과한 회원이 다른 사이트로 이동할때마다 인증을 안거치게 할수있다
function authentication(req,res,next) {
	req.user = 'codeit';
	next();
}
```
## 에러 처리하기
회원가입에 필요한값이 넘어오지않을수있고, 누군가가 가입한 아이디로 들어올수도있고,...
오류가 발생했을때 다른 값으로 돌려주는 에러 핸들러가 필요하다.

express에서는 내장된 에러 핸들러가있다.

```js

function error(req,res,next) {
	throw new Error('에러 발생!');
	next();
}

function ok(req,res,next) {
	res.json({ message: 'OK!'});
}

app.get('/error', error, ok);
// 어떠한 다른 경로가 오더라도
// 에러가 오면 이 핸들러로 실행하게 되어있습니다
// 그것이 싫다면 경로를 설정해주면된다.
// 각 상황에 맞는 적절한 방식을 선택
app.use((err,req,res,next) => {
	console.log(err);
	res.json({message: '에러 핸들러!'})
})
```

## 내장 미들웨어
express에 내장된 미들웨어기능을 내장 미들웨어라고한다.
```js
//express.json()
// express.json() 라우터보다 앞쪽에 위치해야한다.
app,use(express.json());
// 기본적으로 함수를 반환하는 메소드
// app.use((req,res,next) => { ... })
app.post('/products',(req,res) => {
	console.log(req,body) //이 바디내용을 사용하기위해서 express.json()을 사용해야한다.
	res.json({message:"Product 추가히기"});
});

// express.urlencoded()
// 이것또한 사용하는 다른 라우트보다 위에 있어야한다.
app.use(express.urlencoded({extended: true}));
// application/x-www-form-urlencoded
// 이제 아럐 HTTP요청에서 바디부분이 보일껏이다.
POST http://localhost:3000/products
Content-Type: apllication/x-www-form-urlencoded

name=codeit%age=20

// express.static()
// 퍼블릭 파일이 위치한 곳을 아규먼트로 넘겨주면 경로에 요청을보내서 스태틱한 파일에 접근이 가능해진다.
app.use(express.static('public'));

GET http://localhost:3000/codeit.png

###

GET http://localhost:3000/index.html
```

리퀘스트 바디 내용은 req.body에 그냥 가져오는게 아니라 => express.json() 미들웨어가 필요하다.
```js
app.post('/posts', (req,res)=> {
// const title = req.body.title;
// const content = req.body.content 로 해도되긴함
	const { title, content} = req.body;
	res.status(201).json({ title, content})
})
```

## 서드파티 미들웨어
## cookie-parser
리퀘스트로 전달받은 쿠키를 쉽게 파싱할 수 있게 하는 미들웨어이다. 쿠키는 리퀘스트 객체의 헤더 속성에서 확인할수있는데. 헤더의 쿡키 속성을 문자열로 확인할 수 있습니다.
```js
import express from 'express';

const app = express();

app.get('/hello', (req, res) => {
  console.log(req.headers.cookie);
  return res.json({ message: '안녕, 코드잇 (;' });
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});


GET http://localhost:3000/hello
Cookie: taste=chocolate

connect.sid=s%3AgMzrEUPCK2F6vPUSLfXF-laXcxtX5K_g.whufLDegwHxnDM5VVQfqjmz2F6DctlG5Oe%2Fro4mxWQA; taste=chocolate
// 문자열로만 확인이 가능하기 때문에, 쿠키의 값을 편하게 사용하려면 이 문자열을 키와 값으로 분리하는 작업을 해야함

app.use(cookieParser());
// 쿠키파셔를 이용해서 다시 리퀘스트를 보내면
{
  'connect.sid': 's:gMzrEUPCK2F6vPUSLfXF-laXcxtX5K_g.whufLDegwHxnDM5VVQfqjmz2F6DctlG5Oe/ro4mxWQA',
  taste: 'chocolate'
}
// 객체의 내용을 확인할수있다.
```
**mogan**
서버로 들어온 리퀘스트를 로그로 남기는 미들웨어이다.
어떤 리퀘스트를 받았는지 확인해야할때
이러한 로그를 보기 쉽게 자동으로 남겨주는 미들웨어이다.
```bash
npm install morgan
```

```js
import express from 'express';
import morgan from 'morgan';

const app = express();

app.use(morgan('tiny'));

app.get('/hello', (req, res) => {
  return res.json({ message: '안녕, 코드잇 (;' });
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});

GET http://localhost:3000/hello

// 콘솔에서 리퀘스트에 대한 정보를 확인할 수 있다.
GET /hello 200 34 - 2.595 ms

```

**cors**
Cross-origin Resource Sharing의 약자 웹 사이트가 다른 도메인에 있는 리소스에 접근할 수 있도록 브라우저에서 HTTP헤더를 통해 제어하는것을 말한다.

이 라이브러리는 CORS를 허용하기 위해 서버에서 HTTP헤더를 설정시키는데 이설정을 간편하게 해줍니다.
```bash
npm install cors
```

```js
import express from 'express';
import cors from 'cors';

const app = express();

app.use(cors());

app.get('/hello', (req, res) => {
  return res.json({ message: '안녕, 코드잇 (;' });
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```

**multer**
Content-Type이 `multipart/form-data`인 리퀘스트를 간편하게 다룰 수 있는 미들웨어이다.
다양한 타입의 데이터를 전송 가능하게 하는 타입이다.
(특히나 파일 업로드 기능을 구현)

```js
import express from 'express';
import multer from 'multer';

const app = express();

const upload = multer({ dest: 'uploads/' });

app.post('/profile', upload.single('avatar'), function (req, res, next) {
  // ...
});

app.listen(3000, () => {
  console.log('Server is listening on port 3000');
});
```

## 추가
next파라미터는 에러의 처리를 다음 에러 핸들러로 넘기는 것이며 , 에러 처리가 종료된것이 아니며, 서버의 정상 작동 여부는 에러가 어떻게 처리되었는지에 따라 다를 수 있다.

app.get('/error', (req, res, next) => {
  ______ throw new Error('에러 발생!');
});
app.get('/error', (req, res, next) => {
  ____next_(new Error('에러 발생!'));
});

next는 다음 미들웨어 함수를 가리키며 다음 미들웨어로 넘어갈 때 사용되므로 에러객체에 를 전달