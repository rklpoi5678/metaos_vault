## 미들웨어란?
리퀘스트 리스폰스 사이에서 응답,요청을 어떻게 할지 결정하는 경비원같은 존재다.(리퀘스트를 받아 리스폰스를 돌려준다.)
```js
app.get('/', (req,res) => {
	res.json({message: 'Hello'}) //(req,res)이부분을 포함해서 미들웨어라고한다.
})

// 필요한경우 아래처럼 get에(callbackfunction) 넘겨줘도된다.
function greeting(req,res) {
	res.json({ message: 'Hello'});
}
// 이런 방식의 장점은 여러곳에 사용가능하다는것이다.
app.get('/', greeting);
app.get('/hello', greeting);
```

## 미들웨어의 구조
미들웨어는 함수이다. 
```js
// 다음 미들웨어로 넘어가고싶다면 필요한 3번째 파라미터인 next가 필요하다.
// next()를 사용하면 다음 미들웨어를 가리킵니다.
// 파라미터가 4개인 미들웨어는 에러를 처리하는 에러핸들러가있다.
// err에는 에러객체가 들어오게된다.
function greeting(err,req,res,next) {
	next(),
	res.json({message: 'Hello'});
}

//에러 가 있는 미들웨어는 그냥 실행되지않는다.
function greeting(err,req,res,next) {
	next(err); //이런식으로 넘겨주거나
	throw Error;  // 이런식으로 오류를 발생시켜야된다.
}
```

## 미들웨어 사용법 1
파라미터가 3개인 next파라미터가 존재하는 
콜백함수는 다음 콜백함수로 계속 순서대로 실행되게 할수있다.

```js
function meeting(req,res,next) {
	console.log('Ah!');
	next();
}

function waving(req,res,next) {
	console.log('hand shake');
	next();
}

function greeting(req,res,next) {
	console.log('Hello!');
	res.json({message: 'Hello!'});
}

app.get('/hello',meeting,waving,greeting);
// 이처럼 next()를 이용해 다음 미들웨어 함수를 실행할수있습니다.
//그래고 app.get처럼 아규먼트에 넣은 순으로 동작하게된다.
```
## 미들웨어 사용법 2
```js
function greeting(req,res,next) {
	console.log('Hello!');
	res.json({message: 'Hello!'});
}

// all이름에서 알수있듯.get,post,delete등 모든 HTTP메소드에 대한 요청을 전달하겠죠
app.all('hello', greeting);
```

```js
//use는 헬로경로가 있는곳에 매칭되어 use는 무조건 실행됩니다.
app.use('/hello',(req,res,next) => {
	console.log('hello, use');
	next();
})

app.all('/hello/all',(req,res,next) => {
	console.log('hell, all');
	next();
})

app.all('/hello/all',(req,res,next) => {
	console.log('hell, all');
	next();
})

// hello/helloworld로 get을 보내면 상위에 매칭되는 use가 실행되고 hell, word가 출력될것이다.
app.get('/hello/helloworld',(req,res,next) => {
	console.log('hell, word);
	next();
})

//추가로 인자를 안주면 최상위에 매칭이되겠죠
// 어떠한 경로에서도 매칭된다는 말이다.
app.use((req,res,next) => {
	console.log('run!');
	next();
})
```

