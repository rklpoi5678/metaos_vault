## 파일과 multipart/form-data
Content-Type: Media Type 컨텐츠타입을 명시하여 바디에 어떤 타입을 담고있는지 명시한다.
(주로 application/json)

파일을 보낼때는?
1. 파일을 인코딩하여 POST바디에 추가하는것
	1. 효율적이지 못하다. 인코딩과정에서 용량이 30%늘어나기 때문
2. Multipart타입을 사용하는것
	1. Form을 사용하는것(application/x-www-form-urlencoded)
	2. Text는 x-www-form-urlencoded가 되어야하고
	3. 파일은 image/jpeg가 되어야한다.
	4. 이 두타입을 구분해서 넣어줘야했는데 -> multipart등장(multipart/form-data)
	5. 주로 파일데이터를 저장할때 주로 사용하고있다.

## multer 미들웨어 사용하기
```js
//npm install multer
import multer from 'multer';

// dest는 어디다가 놓을까라고 뭍는것이다. 업로드폴더안에
const upload = multer({ dest: 'uploads/'})

// 하나의 파일을 어태치먼트로 해라
// single메소드를 사용하면 미들웨어 그자체를 반환합니다.
app.post('/files', upload.single('attachment')(req,res) => {
	res.json({ message: '파일 업로드 완료!'});
});
```

```http
POST http://localhost:3000/files
Content-Type: multipart/form-data; boundary=Boundary01234567890123456789

--Boundary01234567890123456789
Content-Disposition: form-data; name="attachment"; filename="hello.txt"
Content-Type: text/plain

Hello!
--Boundary01234567890123456789--


```
>서버에서는 파일명을 랜덤하게해서 중복이 안되게하는경우가 많다.

## 서버의 파일 제공하기
파일에 맞는 미들웨어, 경로가 필요하다
```js
// 해당 경로로 접근이 가능하게한다.
app.use(express.static('uploads'));
// http://localhost:3000/abcd.png
app.use('/files',express.static('uploads'));
// http://localhost:3000/files/adcd.png

// 리스폰스를 돌려줘야한다.
app.post('/files', upload.singe('attachment'),(req,res) => {
	const path = `/flies/${req.file.filename}`;
	res.json({ path });
});
```

## 파일은 어디에 있어야 할까?
**데이터베이스와 파일 업로드**
업로드한 파일이 어떤 파일인지에 대한 정보가 함께 필요하다. 이 파일이 프로필사진인지, 게시물의 첨부 파일인지와 같은 추가적ㅇ니 정보들이 함께 기록되어야한다.

대부분의 경우, DB용량 문제로 파일을 데이터베이스에 저장하지 않는다. 파일 자체는 외부에 저장하고,파일의 이름이나 파일이 저장된 위치와 같은 파일에 대한 정보만은 데이터베이스에 보관하는 방식을 주로 사용

**서버와 파일 업로드**
파일을 서버에 저장하는것도 한계, 그래서 별도의 클라우드 스토리지 서비스를 사용하는 경우가 많다.
multer 라이브러리에서 multer인스턴스 생성할때, dest대신에 storage옵션을 사용할수있다.

```js
const upload = multer({ storage:... })
```

**클라이언트에서 스토리지로 직접 업로드**
네트워크를 통해 데이터를 계속 주고받아야 되니 서버의 응답 속도도 느려질수있다. 서버 -> 클라이언트 ULR제공 클라이언트는 해당 URL을 통해 파일을 직접 스토리지에 업로드하는 방식이다.

클라우드 스토리지 서비스를 활용하여 파일 업로드를 구현할 때 해당 방법도 참고해보세요,