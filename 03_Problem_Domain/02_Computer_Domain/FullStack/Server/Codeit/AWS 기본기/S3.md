한 목표에 특화된 서비스이다.
파일을 보관할수있는 "Simple Storage Service"이다.
이미지,오디오, 문서등 다양한 보관할수있다. (비정형 데이터를 보관하는데 특화되어있다.)

사실 구글 드라이브랑 크게 다르지않지만 S3는 주로  개발자들이 쓰는 베이스이다.
인스타그램 포스트에 포함된 이미지들을 여기서 저장할수있다는것이다.
S3의 단위는 버킷이라고한다.(확장성) 인스턴스에 스펙을  업그레이드하는것과 늘리는것처럼말이다.

저장된 데이터는 고유한 URI가  달린다.
버킷안에 담기는 데이터를 객체라고하고 키가 달린다. 객체안에는  데이터와 메타데이터가 들어간다.
EC2와 함께 AWS에서 가장 대표하는  서비스라고 볼수있다.

## 버킷 만들기
\> 리전 설정 + 버킷  이름 설정  > 퍼블릭 엑세스는 특별한 경우가 아니면 차단하는것이 좋다. > 태그  기본암호화 설정 > 버킷 만들기
S3를 포함한 몇몇서비스는 글로벌이고 ,  전세계에서 유일해야한다. 쉽게 설명해서 하나의 컨트롤타워를 두는것이다. 물론 버킷에 데이터를 쓰면  해당 리전에 데이터센터에 보관된다.

## 버킷에 이미지 업로드 하기
업로드에서 파일을 끌거나 , 파일을 선택하여 업로드 할수있다.
메타데이터는 객체작업 > 메타데이터 편집에서 확인할수있다.(커스텀 메타데이터도 넣을수있다.)
각 키는 버킷의 경로에 해당하기도 한다.(똑같은 이미지이름으로 중복되는경우 덮어쓰기에 모든 이름(키)는 고유해야한다. 주의!)

객체URL를 보면 최상위에서 (컨트롤타워)관리하기에 중복없이 각 유저마다 고유한 버킷주소를 가질수있게되는것이다.

URL에 인증부분을 지우면 접근이 차단된다.

## 미리 서명된 URL
미리 서명된 URL(Pre-signed URL): 왜 쓰냐면 퍼블릭으로 해두면 
예를들어 백에서  아무리 팔로워가 아닌사람에게 보여주지 않게 설정해둬도 공유하거나, 탈퇴한사람이  URL에 접할수있다면  버킷에서 해당 데이터를 주게 되어버린다. 그 문제를 막기위함이다.
> 미리 서명된 URL은 결국 만료되기때문에 나중에 접근이 안되어버리게 시킬수있다.
![[Pasted image 20251004021326.png]]> 다시 버킷에 접근하기위해 임시 인증 정보를 받아야된다.
버킷에 1분을 설정해두면 1분까지 다운로드가 되면 클라이언트쪽에서 나가지 않기만 하면 계속 이미지를 볼수있다.
미리 서명된 URL은 S3을 다룰때 매우 중요한 정보이다.

## AWS SDK1
AWS를 활용하는 앱을  만들때는 이 SDK 를 활용합니다.
@aws-sdk/client-s3 를 설치한다.
```js
const { S3Client, PubObjectCommand } = required("@aws-sdk/client-s3");
// 파일 시스템 모듈
const fs = required("fs");

const filePath = "mountain.jpg"
const fileStream = fs.createReadStream(filePath);

// 버킷 인증을 위함
// 새로운 프로젝트는 새로운 IAM을 하나더 만드는것이 안전하다.
// 권한을 S3 PubOject하나만 쓸거니 하나 추가 
// ARN 지정(Amazon Resouce Name)
// 이름 추가후 모든 객체 이름을 추가 + 정책  네임 추가후 정책 추가
// 사용자 생성후 사용자 콘솔 해제 직접 정책 연결후 방금 만든 정책을 추가한다.
// 엑세스 키 만들기 -> 로컬 코드 -> 태그 생략후 엑세스 키를 발급받는다.
// 비밀 엑세스키를 어딘가에 저장한다.(.csv파잃활용)
const bucketName = 'codeit-bucket'
const region = 'ap-northeast-2'
const accessKeyId = 'AKIA..'
// 실제 서비스에서 환경변수를 통해 주입해야됩니다.
const secreatAccessKey = '절대 공개 금지'

// s3 client에 요청할 코드
const s3 = new S3Client({
	region,
	credentials: {
		accessKeyId,
		secretAccessKey	
	}
});

// 어떤 파일에 어떤 내용을 올릴건지 params에 담아
const params = {
	Bucket: bucketName,
	Key: "image/mountain.jpg",
	Body: fileStream,
	ContentType: "image/jpeg"
}

// 넣어주는 객체에 해당  파람스를 넣고 커멘드에 담아주었다.
const command = new PubObjecCommand(params);
// 실제로 보내줍니다.
s3.send(command)
.then((data) => {
	console.log('Object uploaded successfully:",  data)
})
.catch((err) => {
	console.log('Error uploading object to S3', err.message ||  err);
});
```
실제 상황에서는 유저가 요청하면 저장시키게 할수있겠고, 여러 바리에이션으로 갈수있겠죠

## 정적 웹사이트 호스팅
퍼블릭 엑세스 허용할때는  대표적인 예로 정적 웹사이트 호스팅을 할때이다.
유저가  동일한  화면을 볼때 정적 웹사이트를 만든다.(html,css,js 를 그대로  내려줌)
s3에 html,css,js 를 그냥넣어서 보낼수있다 그래서 s3를 정적 호스팅할때  사용하는이유이다.

퍼블릭엑세스 허용 > 나머지 설정 ... > 생성된 버킷에 정적 웹 사이트 호스팅 편집에서 인덱스  문서를  정한다.(인트로 페이지, 엔트리) > 변경 사항  저장 > 권한 > 버킷 정책 편집
```json
{
  "Version": "2012-10-17",
  "Statement": [
      {
          "Sid": "PublicReadGetObject",
          "Effect": "Allow",
          "Principal": "*",
          "Action": [
              "s3:GetObject"
          ],
          "Resource": [
              "arn:aws:s3:::my-buket-name/*"
          ]
      }
  ]
}
```
s3에서 html.css.js업로드  > s3열기로 우리가 만든 웹사이트를 볼수있다.

## AWS CLI
파일을 업로드할때 cli를  쓴다.
공식문서를 확인하여 aws cli를 설치한다.
```
aws --version # 버전확인

엑세스키
시크릿 엑세스키 입력
리전
아웃풋 포맷등등

aws s3 cp /Users/... index.html s3://my-bucket-website/index.html
```