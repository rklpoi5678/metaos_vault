##  이미지 관리하기
원래 next.js , django처럼 원래  node.js, python을 사용하는것처럼 환경이 존재하고 ,  더  필요한  환경이  있다면  이미지를 만들때 하나하나 다시 만들어야하니 복잡하다.
이미지는  레이어이니 dockerHub에서 이러한 환경을 (레이어를) 가져올수있다.

**docker image**
도커에 이미지를 다루는 명령어는 이명령어로 시작한다.

docker image pull이라는 명령어로 이미지를 다운받을수있다.
```bash
docker image pull node:20.15.1 ##<image name>:<digest or tag> 일반적으로 별칭을 사용

# 다이제스트 사용
docker image pull  node@sha256:sha256:623518d7799113a3fb28c0c248744a18bce264c18674556768384517f90a2407 ##   <imagename>@<digest>

# 기본태그 latest적용
docker image pull node ## : latest가 자동적용됨

## 이미지들  확인
docker image ls # docker images(is별칭)
```
> 받을 때 여러가지를 pull하는데 이  이유도 여러파일 ->  레이어로 나눠지기 때문이다.
> 참고로 태그가  지정되지 않은 이미지를 뱅글링 이미지라고 한다.

```bash
# 후에 필요없는 도커 이미지들이 많아졌다면 파일이기때문에 리눅스 명령어로 삭제가능
docker image rm node:20.15.1

# 필요없는 이미지가 많을경우
docker image prune # 이것만 치면 기본적으로  태그가없는 뱅글링 이미지만 삭제됨
docker image  prune -a  #  모든 이미지 삭제
```

## Dockerfile 작성하기
dockerfile은 레이어를 어떻게 쌓아올릴지를 설정하는것이다. 즉 도커파일에는  애플리케이션을 실행하기위한 방법을 잘적어놓으면된다는 것이다.
```docker
# node를 설치한다.
# FROM 베이스 이미지
ARG NODE_VERSION
FROM node:${NODE_VERSION}

# 소스코드를 다운로드한다.
# COPY [복사할 경로 호스트경로 상대경로] [붙여넣기할 경로 도커파일 절대경로]
COPY . /app

# 소스코드의 최상위 디렉토리로 이동한다.
WORKDIR /app

# 소스코드를 실행할 때 필요한 파일을 다운로드한다. (npm ci)
RUN npm ci

# 소스코드를 빌드한다. (npm run build)
RUN npm run build
# 보통은 이렇게 두개가 비슷하면 AND로 묶어주는게 일반적이며 추천하는 방식(레이어떄문)
## RUN npm ci && npm run build
### RUN npm ci \
###  && npm run build

# 환경 변수를 정의한다. (PORT)
ENV PORT=3000

# 서버를 실행한다. (npm run start)
ENTRYPOINT ["npm", "run", "start"] 
## 물론 npm  run start해도 되지만 이러한 특이한 형태로 작성하는것을 권장함
```
도커파일에 올리지않을 숨김파일처리
.으로 처리된 파일들은 애초에 올라가질않는 파일이라고 명시된다. (.next라고 입력하지 않아도되는것)
```dockerignore
node_modules
```

##  이미지  빌드/ 배포하기
빌드하고 배포하기위해 dockerfile, Build Context가 필요하다

**docker buildx build(docker image  build도 되지만 )이것을 권장**
docker buildx build \[option] \[build context]
```linux/macOS
mbti-embedded-db >
					docker builx build \
					-t learncodeit/mbti:embedded-db \
					-t learncodeit/mbti \
					--build-arg NODE_VERSION=20.15.1 \
					-f./Dockerfile \
					--pull \
					.
```
```Windows
mbti-embedded-db >
					docker builx build `
					-t learncodeit/mbti:embedded-db `
					-t learncodeit/mbti `
					--build-arg NODE_VERSION=20.15.1 `
					-f./Dockerfile `
					--pull `
					.
```
-t 계정이름
--build-arg로 도커파일에 ARG옵션에 넣어줄수있다.
-f 사용할 도커파일의 경로를 설정함
-- pull 도커파일이 있어도 강제로 다운로드 하라는 의미 (빌드할때 최상위 태그를 사용할수있게함)
. 는 빌드컨텍스트를 현재 경로로 설정하겠다는 말이다.