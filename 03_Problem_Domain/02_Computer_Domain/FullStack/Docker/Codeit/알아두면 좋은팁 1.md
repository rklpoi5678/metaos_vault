## ENTRYPOINT와 CMD의 관계
**shell형식과 exec형식**
```shell
RUN npm  ci \
	&& npm run  build
```
> 터미널 명령어를 사용하듯이 그대로 작성

```exec 형식
ENTRYPOINT ["npm", "run", "start"]
```
> JSON배열이기에 작은 따옴표가아닌 큰따옴표사용

**쉘 프로세싱**이란 쉘이 명령어를 처리하는 과정을 의미하는데요. 가장 대표적인 예가 환경 변수 치환입니다.
```bash
export PORT=3000
echo ${PORT}
# 3000
```

shell 형식은 자동으로 쉘 프로세싱이 동작하지만, exec 형식은 그렇지 않습니다. 예를 들어 아래처럼 작성하면 환경 변수 치환이 안 돼요.

```
FROM ubuntu 
ENV MY_NAME=codeit
ENTRYPOINT ["echo", "My name is ${MY_NAME}"]
```
> ${MY_NAME}을 문자 그대로 인식함
> sh -c명령어로 직접 쉘 프로세싱을 해주어야함

```bash
sh -c "실행할 명령어"
```

```
FROM ubuntu ENV MY_NAME=codeit 
- ENTRYPOINT ["echo", "My name is ${MY_NAME}"]
+ ENTRYPOINT ["sh", "-c", "echo \"My name is ${MY_NAME}\""]
```

## `RUN` vs `CMD`, `ENTRYPOINT`
`RUN`은 CMD, ENTRYPOINT와 확연히 다른 점
정의한 명령어를 실행하는 시점

`RUN` 명령어는 이미지를 빌드할 때 실행될 명령어를 정의
`CMD`와 `ENTRYPOINT`는 컨테이너가 시작했을 때 실행할 명령어를 정의합니다. 비교적 명확한 차이점

## `MD` vs `ENTRYPOINT`

사실 정말 헷갈리는 건 `CMD`와 `ENTRYPOINT`입니다.
`CMD`는 `docker container run` 명령어에서 새로 정의가능,
반면에 `ENTRYPOINT`는 덮어쓸 수 없어요.
```docker
FROM ubuntu
- ENTRYPOINT ["echo", "Welcome to Codeit."]
+ CMD ["echo", "Welcome to Codeit."]


# docker container run [옵션] [이미지] [CMD]
docker container run myimage echo "Learn to love learning."

# Learn to love learning. (O)
# Welcome to Codeit. (X)
```
이런 특성이 있다 보니 `CMD`는 그때그때 목적에 맞는 명령어(**애드혹(ad-hoc) 명령어**)를 실행해보고 싶은 경우 활용
```docker
docker container run \
    --rm \
curlimages/curl \
curl mbti:3000/api/healthcheck
```
반면에 `ENTRYPOINT`는 컨테이너를 시작할 때 반드시 실행해야 하는 명령어인 경우에 활용
. 우리가 만들었던 mbti 이미지는 컨테이너가 시작되면 반드시 `npm run start` 명령어로 서버를 실행해야 했죠. 그래서 `ENTRYPOINT`로 정의했던 것입니다.

`... ENTRYPOINT ["npm", "run", "start"]`

여기까지는 꽤 명확

문제는 `CMD`와 `ENTRYPOINT`가 같이 사용되었을 때

## `CMD`의 또 다른 기능

`CMD`와 `ENTRYPOINT`가 같이 사용되면 `CMD`의 기능이 완전히 바뀝니다. `CMD`는 `ENTRYPOINT`에서 실행할 명령어의 파라미터 역할을 해요.(`CMD`와 `ENTRYPOINT`가 함께 사용될 때, `CMD`는 `ENTRYPOINT` 명령어의 파라미터로 사용됩니다.)

```docker
FROM ubuntu
CMD ["Codeit"]
ENTRYPOINT ["echo", "Welcome To "]

# docker container run [옵션] [이미지] [CMD]
docker container run myimage Seoul
>> Welcome To Seoul
docker container run myimage Busan
>> Welcome To Busan
>> 
>> ## `CMD` 명령어 이름과 동작하는 기능이 달라 조금 어색하긴 하지만, 자주 사용되는 패턴이니 익혀둡시다.
```
적어도 작성 형식에 따라 달라지는 경우의 수는 줄이는 게 덜 복잡할 거예요. 그래서 일반적으로 `CMD`와 `ENTRYPOINT`는 exec 형식으로 통일해서 작성합니다. 반면에 `RUN`은 작성 형식에 따라 추가로 복잡해질 규칙이 따로 없어서 가독성이 좋은 shell 형식으로 작성하는 경우가 많아요.