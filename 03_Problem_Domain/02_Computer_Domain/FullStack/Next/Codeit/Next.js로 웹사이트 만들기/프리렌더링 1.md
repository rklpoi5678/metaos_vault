## 핵심 프리렌더링이란?
프리렌더링은 웹페이지 로딩 이전에 하는 렌더링이다.
시간상으로는 브라우저가 html을 받아오는 시점이전에 프리렌더링이 일어납니다.

Static Generation(정적 생성):  빌드시점에 렌더링을  하는것이다.
Server-side randering(서버사이드 렌더링): 리퀘스트가 들어오면 렌더링( 리퀘스트들어올때마다 서버가 돌면서 렌더링해주는방식)

이미렌더링된 데이터와 리액트 데이터를 연결하는작업을 Hydraion이라고한다.

프리린더링의 좋은점: 초기 로딩이 빨라진다. 검색엔진 최적화가 된다.

## 정적 생성1
빌드시점에 미리 html을 렌더링하는것 next.js에서는 아무것도 안해도 정적생성을 기본적으로 해준다.
useEffect를 실행하기전에 되기에 hydration이 끝나고 나서야 useEffect가 실행되고 가져올수있다.
(useEffect는 서버에서 실행되지않고, 웹브라우저에서 다 로딩되고 웹브라우저에서 실행되는 코드라고 생각할수있다.)

그래서 next.js에서만 쓰는 특이한 문법으로 정적생성시 데이터를 가져올수있다.
```js
// export 와 getStaticProps를 붙이면 next.js가 정적생성때 이 함수를 실행해준다.
export async function getStaticProps() {
// 이제 여기서는 리액트 훅같은것을 사용할수없다.
const res = await axios.get('/products');
const products = res.data.results;

// 이함수는 프롭으로 내려줄값을 만드는 함수
	return (
		props: {
			products,	
		}	
	)
}

// 즉 Home 컴포넌트의 프롭으로 프롭을 products라는 이름으로 내려준다는 애기
export default function Home({ products }) {
	return (
		...	
	)
}
```
항상 자주 바뀌고 새롭게 생성되어야하는 상황에서는 정적생성이 유용하지않다.
> 다만 정적이라는 말은 고정된 페이지가 아니라 빌드할때  프리렌더링을 한다. 즉 , HTML을 미리 만들어놓는다.

next.js는 기본적으로 정적생성이고 정적생성하는데 데이터를 가져와서 쓰고 싶다면 위 예제에있는 함수를 사용해서 프롭스로 내려주면된다.

## 정적 생성 2
```js
export async function getStaticPaths() {
	return {
		paths: [
		// 각 상품의 아이디를 일단 몇개 설정
			{ params: { id: '1'}},	
			{ params: { id: '2'}},	
		],
		// 없는 경로는 어떻게 처리할지를 지정하는 것을 fallback 이라함
		// false시 없는 경로는 따로 정적 생성하지 않겠다라는 의미
		// true로 설정이 없는 경로를 접근하면 getStaticProps를 실행하여 정적생성
		// 이럴경우 미리 정적생성해놓지 않았기에 로딩이걸림
		fallback: false,
	}
}

// context로 params의 값을 가져올수있다.
export async function getStaticProps(context) {
// next.js 는 빌드할때 어떠어떠한 파람스가 있는지 모른다.
// 그러기위해  export getStaticPaths(){}
// 다이나믹한 동적인 페이지를 구성할때 어디어디인지를 구성하는 용도
const productId = context.params['id'];
const res = await axios.get(`/products/${productId}`);
const products = res.data;

	return (
		props: {
			products,	
		}	
	)
}

// bad-id처럼 완전 없는 값을 참조할경우 서버 에러가 나는데 try-catch로 잡아준다.

...
let products;
try {
	const res = await axios.get(`/products/${productId}`);
	products = res.data;
} catch {
	return (
		notFound: true,	
	);
}

// 
...
const res = await axios.get(`/products/`);
const products = res.data.results;
const paths = products.map((product) => ({
	params: {id: String(product.id)},
}));

return (
	paths,
	fallback: true,
)
```
> 빌드할때 먼저 next.js는 getStaticPath를 봅니다. paths로 내려준값을 참고하여 각 경로에 해당하는 페이지를 만듬 getStaticProps에서는 주소를 참고해서 해당하는 데이터를 받아오고  프롭스를 만들어서 내려준다.

> npm run dev 개발환경에서는 그때 그때 수정사항이 생기지만 실제 프로덕션 빌드시에는 딱한번만 생성된다.

> 일부 주요페이지만 정적으로 생성하고, 나머지는 fallback을 활용해 요청 시 로딩하는 방식이 효율적이다.

